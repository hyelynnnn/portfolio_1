<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
   <h2>상품등록</h2>
   <button id="add">등록</button>
   <div id="result"></div>

   <button id="list">상품목록</button>
   <div id="products"></div>

<script>
    document.querySelector("#add").addEventListener("click", registerProuct);
    document.querySelector("#list").addEventListener("click", listProuct);

    /**
     * 상품등록 비동기 요청
     * @param item
     * @returns {Promise<any>}
     */
    function  registerRequest(item){
        const url = "/item";
        const productJson = JSON.stringify(item);

        let option = {
            method: "post",
            headers: {
                "Content-Type": "application/json"
            },
            body: productJson
        };

        return fetch(url, option)
            .then((response) => {
                return response.json();
            });
    }

    /**
     * 상품 목록 요청
     * @param item
     * @returns {Promise<any>}
     */
    function  listRequest(){
        const url = "/item";
        return fetch(url)
            .then((response) => {
                return response.json();
            });
    }

    async function registerProuct(){
        // 폼필드에서 데이터 읽기 가정
        const producId = 100;
        const name = "삼송 TV";
        const price = 1000;
        // 폼데이터에 대한 유효성 검증 생략
        const item = {
            productId : producId,
            name : name,
            price : price
        };
        const productJson = await registerRequest(item);
        //console.log(productJson);
        showResultMessage(productJson);
    }

    async function listProuct(){
        const productArray = await listRequest();
        // console.log(productArray);
        showProductList(productArray);
    }

    function showResultMessage(item){
        // DOM API를 이용한 상품 등록 결과 보여주기
        const resultDiv = document.querySelector("#result");
        resultDiv.innerHTML = `${item.name} 상품이 정상 등록되었습니다.`;
    }

    function showProductList(productArray){
        let table = `<table border='1' width='50%'>
                       <tr>
                         <th>상품번호</th>
                         <th>상품이름</th>
                         <th>상품가격</th>
                       <tr>`;
        productArray.forEach((item) => {
            table += `<tr>
                         <td>${item.productId}</td>
                         <td>${item.name}</td>
                         <td>${item.price}</td>
                      </tr>`;
        });
        table += `</table>`;
        const resultDiv = document.querySelector("#products");
        resultDiv.innerHTML = table;
    }
</script>
</body>
</html>













